# 📦 打包部署指南

## 🎯 概述

本项目使用 **PyInstaller** 将 Python 应用打包为独立的可执行文件。
已配置 GitHub Actions 自动化工作流，支持构建：

- ✅ **Windows** - `.exe` 文件夹/压缩包
- ✅ **macOS** - `.dmg` 安装包
- ✅ **Linux** - `.tar.gz` 压缩包

---

## 🚀 自动打包流程 (GitHub Actions)

### 方式一：Tag触发（推荐）

创建以 `v` 开头的标签即可自动构建和发布：

```bash
# 1. 提交代码
git add .
git commit -m "发布 v2.0.0"

# 2. 创建标签
git tag v2.0.0

# 3. 推送标签
git push origin v2.0.0
```

GitHub Actions 会自动：
1. 构建 Windows/Mac/Linux 版本
2. 创建 Release
3. 上传构建产物

### 方式二：手动触发

1. 进入 GitHub 仓库
2. 点击 **Actions** 标签
3. 选择 **构建桌面应用** (Build Desktop App) 工作流
4. 点击 **Run workflow**

---

## 💻 本地手动打包

确保已安装依赖：
```bash
pip install -r requirements.txt
pip install pyinstaller
```

### Windows 打包

```powershell
pyinstaller --name="物流视频管理" ^
  --windowed ^
  --onedir ^
  --icon=build/icon.png ^
  --add-data="config.json.example;." ^
  --add-data="web;web" ^
  run.py
```
> 输出目录：`dist/物流视频管理/`

### macOS 打包

```bash
pyinstaller logistics-video.spec
```
> 输出目录：`dist/物流视频管理.app`
> 可进一步制作 DMG (需 `create-dmg` 工具或手动)。

### Linux 打包

```bash
pyinstaller --name="物流视频管理" \
  --windowed \
  --onefile \
  --icon=build/icon.png \
  --add-data="config.json.example:." \
  run.py
```
> 输出文件：`dist/物流视频管理`

---

## 🔧 常见问题

1. **依赖安装失败**
   - 确保 pip 源可用，尝试国内源：`-i https://pypi.tuna.tsinghua.edu.cn/simple`

2. **Qt 插件缺失**
   - `run.py` 内置了 PyInstaller 环境下的 Qt 插件查找逻辑，一般无需额外配置。
   - 如遇报错，检查 `.spec` 文件中的路径设置。

3. **Web 服务**
   -目前 Web 服务 (`web_server.py`) 未打包为独立程序，需在有 Python 环境下运行 `python web_server.py`，或随应用分发 Python 环境。
